# Техническая архитектура системы

## Компоненты системы

### 1. Spring Cloud Gateway
- **Роль**: Единая точка входа для всех клиентских запросов
- **Функции**:
  - Маршрутизация запросов к соответствующим микросервисам
  - Настройка CORS для кросс-доменных запросов
  - Circuit Breaker для защиты от сбоев
  - Load Balancing между экземплярами сервисов

### 2. Eureka Server (Service Discovery)
- **Роль**: Реестр всех микросервисов в системе
- **Функции**:
  - Регистрация новых сервисов
  - Отслеживание состояния сервисов
  - Предоставление информации о доступных сервисах

### 3. Config Server (External Configuration)
- **Роль**: Централизованное управление конфигурацией
- **Функции**:
  - Хранение конфигураций для всех сервисов
  - Поддержка различных профилей (dev, prod, docker)
  - Динамическое обновление конфигурации

### 4. User Service
- **Роль**: Основной бизнес-сервис для управления пользователями
- **Функции**:
  - CRUD операции с пользователями
  - Валидация данных
  - Отправка событий в Kafka
  - Circuit Breaker для внешних вызовов

### 5. Notification Service
- **Роль**: Сервис для отправки уведомлений пользователям
- **Функции**:
  - Обработка событий из Kafka
  - Отправка email уведомлений
  - REST API для отправки уведомлений
  - Интеграция с SMTP серверами

## Паттерны Spring Cloud

### 1. API Gateway Pattern
- **Реализация**: Spring Cloud Gateway
- **Преимущества**:
  - Единая точка входа
  - Централизованная аутентификация/авторизация
  - Rate limiting
  - Мониторинг трафика

### 2. Service Discovery Pattern
- **Реализация**: Netflix Eureka
- **Преимущества**:
  - Автоматическое обнаружение сервисов
  - Отказоустойчивость
  - Масштабируемость

### 3. Circuit Breaker Pattern
- **Реализация**: Resilience4j
- **Преимущества**:
  - Защита от каскадных сбоев
  - Быстрый отказ при недоступности сервиса
  - Автоматическое восстановление

### 4. External Configuration Pattern
- **Реализация**: Spring Cloud Config
- **Преимущества**:
  - Централизованная конфигурация
  - Версионирование конфигураций
  - Безопасность конфигураций

## Поток запросов

1. **Клиент** отправляет HTTP запрос на Gateway (порт 8080)
2. **Gateway** определяет целевой сервис через Eureka
3. **Gateway** применяет Circuit Breaker и Load Balancing
4. **User Service** обрабатывает запрос и взаимодействует с БД
5. **User Service** отправляет событие в Kafka (с Circuit Breaker)
6. **Notification Service** получает событие из Kafka и отправляет email
7. **Gateway** возвращает ответ клиенту

## Мониторинг и наблюдение

- **Eureka Dashboard**: http://localhost:8761
- **Config Server**: http://localhost:8888
- **Health Checks**: /actuator/health
- **Circuit Breaker Metrics**: /actuator/circuitbreakers
- **Swagger UI**: http://localhost:8080/swagger-ui.html

## Конфигурация сервисов

### User Service
- **Порт**: 8081
- **База данных**: PostgreSQL
- **Kafka**: Отправка событий
- **Circuit Breaker**: Для Kafka операций

### Notification Service
- **Порт**: 8082
- **Kafka**: Получение событий
- **Email**: Gmail SMTP
- **REST API**: Ручная отправка уведомлений

### Gateway Service
- **Порт**: 8080
- **Маршруты**: 
  - `/api/users/**` → User Service
  - `/api/notifications/**` → Notification Service
- **Circuit Breaker**: Для всех сервисов

## Безопасность

- **CORS**: Настроен для всех доменов
- **Email**: Использует App Password для Gmail
- **Kafka**: Локальная сеть
- **Database**: Локальное подключение

## Масштабируемость

- **Horizontal Scaling**: Каждый сервис может быть масштабирован независимо
- **Load Balancing**: Автоматическое распределение нагрузки через Eureka
- **Circuit Breaker**: Защита от перегрузки
- **Configuration**: Централизованное управление конфигурацией